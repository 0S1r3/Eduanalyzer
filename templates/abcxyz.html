<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/profile.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- Socket.io JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.min.js"></script>
    <!-- Sortable JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>

    <!-- ECharts + ECharts-GL для 3D -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>


    <!-- DataTables core -->
    <link rel="stylesheet" 
    href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <!-- Buttons extension -->
    <link rel="stylesheet" 
    href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>

    <!-- Зависимости для HTML5-экспорта -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

    <!-- Собственно кнопки экспорта -->
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>

    <script src="js/scripts.js" defer type="module"></script>
    <script src="js/abcxyz.js" defer></script>
    <script src="js/profile.js" defer></script>


    <title>ABC/XYZ-анализ успеваемости и посещаемости</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="header">
        <div class="profile-container">
            <div class="profile-icon" id="profileIcon">
                <img id="userPhoto" alt="Профиль" />
            </div>
            <div class="profile-dropdown" id="profileDropdown">
                <a href="{{ url_for('profile') }}" class="dropdown-button">Профиль</a>
                <a href="{{ url_for('logout') }}" class="dropdown-button">Выход</a>
            </div>
        </div>

        <img src="/static/favicon.png" alt="Логотип" class="header-logo" />
        <a href="/main">Главная</a>
    </div>

    <h1 style="text-align: center; font-family: Arial, sans-serif;">Загрузка данных учеников</h1>

    <div class="tabs">
        <div class="tab active" onclick="openTab(event, 'uploadStudents')">Загрузка списка учеников</div>
        <div class="tab" onclick="openTab(event, 'uploadExcel')">Загрузка Excel</div>
        <!-- <div class="tab" onclick="openTab(event, 'uploadPhotos')">Загрузка фото</div>-->
    </div>
    
    <div id="uploadStudents" class="tab-content active">
        <!-- Загрузка данных из Базы данных -->
        <div class="container">
            <h2>Загрузка данных учеников</h2>
            <form id="filter-form-no-selector-graph">
                <div class="filter-row">
                    <select id="classSelect">
                        <option value="">Выберите класс</option>
                        <!-- Динамически заполняемые классы -->
                    </select>
                </div>
                <div class="filter-row">
                    <select id="classLetterSelect">
                        <option value="">Выберите букву класса</option>
                        <!-- Динамически заполняемые буквы классов -->
                    </select>
                </div>
                <div class="filter-row">
                    <select id="subjectSelect">
                        <option value="">Выберите предмет</option>
                        <!-- Динамически заполняемые предметы -->
                    </select>
                </div>
                <div class="filter-row">
                    <select id="teacherSelect">
                        <option value="">Выберите преподавателя</option>
                        <!-- Динамически заполняемые преподаватели -->
                    </select>
                </div>
                <div class="filter-row" style="display: none;">
                    <select id="performanceSelect">
                        <option value="grades">Успеваемость</option>
                        <option value="attendance">Посещаемость</option>
                    </select>
                </div>
                <div class="filter-row">
                    <select id="periodSelect">
                        <option value="">Выберите период</option>
                        <!-- Динамически заполняемые периоды -->
                    </select>
                </div>
                <div class="filter-row">
                    <select id="periodSelectYear">
                        <option value="">Выберите год обучения</option>
                        <!-- Динамически заполняемые года обучения -->
                    </select>
                </div>
                <button type="button" onclick="loadDataABCXYZ()">Загрузить данные</button>
            </form>
        </div>    
    </div>

    <div id="uploadExcel" class="tab-content">
        <!-- Загрузка данных из Excel -->
        <div class="containerForUpload">
            <h2>Загрузка Excel</h2>
            <form id="uploadFormABCXYZ" action="/uploadabcxyz" method="post" enctype="multipart/form-data">
                <div class="upload-area" id="uploadArea">
                    <img src="/static/upload.png" alt="Upload Icon" width="50">
                    <p>Перетащите файлы сюда</p>
                    <label for="fileInput" style="cursor: pointer; color: #007bff;">Выберите файл</label>
                    <input type="file" id="fileInput" style="display: none;">
                </div>
                <button class="start-button">Загрузить файл Excel</button>
            </form>
        </div>
    </div>

    <h1 id="analysisHeader1" style="display: none;">Успеваемость учащихся</h1>
    <div class="containerTable" style="display: none;">
        <table id="studentTablePerf">
            <thead>
                    <!-- Headers will be dynamically populated here -->
            </thead>
            <tbody>
                <!-- Data will be dynamically populated here -->
            </tbody>
        </table>
    </div>

    <h1 id="analysisHeader2" style="display: none;">Посещаемость учащихся</h1>
    <div class="containerTable" style="display: none;">
        <table id="studentTableAttend">
            <thead>
                <!-- Headers will be dynamically populated here -->
            </thead>
            <tbody>
                <!-- Data will be dynamically populated here -->
            </tbody>
        </table>
        <button onclick="analyzeABCXYZData()">Выполнить ABC/XYZ-анализ</button>
    </div>

    <button id="settingsBtn" class="settings-btn">
        <img src="/static/settings.png">
        <i class="fas fa-cog"></i>
    </button>
    <div id="settingsMenu" class="settings-menu">
        <h2>Настройки ABC/XYZ-анализа</h2>
        <div class="slider-container">
            <label for="thresholdA">Порог категории A:</label>
            <input type="number" id="thresholdA" value="0.7" step="0.05" min="0" max="1">
        </div>
        <div class="slider-container">
            <label for="thresholdB">Порог категории B:</label>
            <input type="number" id="thresholdB" value="0.2" step="0.05" min="0" max="1">
        </div>
        <div class="slider-container">
            <label for="thresholdC">Порог категории C:</label>
            <input type="number" id="thresholdC" value="0.1" step="0.05" min="0" max="1">
        </div>        
        <div class="slider-container">
            <label for="analysisMeasure">Мера (ABC-анализа):</label>
            <select id="analysisMeasure">
                <option value="averageGrade">Средняя оценка</option>
                <option value="gradePeriod">Оценка за период</option>
                <option value="quarter1">1 четверть</option>
                <option value="quarter2">2 четверть</option>
                <option value="quarter3">3 четверть</option>
                <option value="quarter4">4 четверть</option>
                <option value="year">Год</option>
                <option value="medium1">1 полугодие</option>
                <option value="medium2">2 полугодие</option>
                <option value="yearTotal">Итог.</option>
                <option value="periodTotal">Итог за период</option>
            </select>
        </div>

        <div class="slider-container">
            <label for="startQuarter">Начальный период:</label>
            <select id="startQuarter">
                <optgroup label="Четверти">
                    <option value="Q1">1 четверть</option>
                    <option value="Q2">2 четверть</option>
                    <option value="Q3">3 четверть</option>
                    <option value="Q4">4 четверть</option>
                </optgroup>
                <optgroup label="Полугодия">
                    <option value="H1">1 полугодие</option>
                    <option value="H2">2 полугодие</option>
                </optgroup>
                <optgroup label="Итог">
                    <option value="I">Итог за период</option>
                </optgroup>
            </select>
        </div>
        
        <!-- Dropdown for selecting end quarter -->
        <div class="slider-container">
            <label for="endQuarter">Конечный период:</label>
            <select id="endQuarter">
                <optgroup label="Четверти">
                    <option value="Q1">1 четверть</option>
                    <option value="Q2">2 четверть</option>
                    <option value="Q3">3 четверть</option>
                    <option value="Q4">4 четверть</option>
                </optgroup>
                <optgroup label="Полугодия">
                    <option value="H1">1 полугодие</option>
                    <option value="H2">2 полугодие</option>
                </optgroup>
                <optgroup label="Итог">
                    <option value="I">Итог за период</option>
                </optgroup>
            </select>
        </div>
        

        <!-- Slider for category X threshold -->
        <div class="slider-container">
            <label for="thresholdX">Порог категории X:</label>
            <input type="range" id="thresholdX" min="0" max="100" value="10"
                oninput="updateThresholdValue('thresholdX', 'thresholdXValue')">
            <span id="thresholdXValue">10%</span>
        </div>

        <!-- Slider for category Y threshold -->
        <div class="slider-container">
            <label for="thresholdY">Порог категории Y:</label>
            <input type="range" id="thresholdY" min="0" max="100" value="25"
                oninput="updateThresholdValue('thresholdY', 'thresholdYValue')">
            <span id="thresholdYValue">25%</span>
        </div>

        <!-- Slider for category Z threshold -->
        <div class="slider-container">
            <label for="thresholdZ">Порог категории Z:</label>
            <input type="range" id="thresholdZ" min="0" max="100" value="65"
                oninput="updateThresholdValue('thresholdZ', 'thresholdZValue')">
            <span id="thresholdZValue">65%</span>
        </div>
    </div>
    

    <h1 id="analysisHeader" style="display: none;">XYZ/ABC-анализ успеваемости и посещаемости</h1>
    <div class="container-centered">
        <!-- Карточки-метрики -->
        <div id="metricsCards" class="metrics-cards" style="display:none;">
            <div class="card">
                <div class="card-title">Всего учеников</div>
                <div class="card-value" id="totalCount">–</div>
            </div>
            <div class="card" style="background-color: #00ff00;">
                <div class="card-title">Категория AX</div>
                <div class="card-value" id="countAX">–</div>
            </div>
            <div class="card" style="background-color: #99ff00;">
                <div class="card-title">Категория AY</div>
                <div class="card-value" id="countAY">–</div>
            </div>
            <div class="card" style="background-color: #cfff5f;">
                <div class="card-title">Категория AZ</div>
                <div class="card-value" id="countAZ">–</div>
            </div>
            <div class="card" style="background-color: #ffff00;">
                <div class="card-title">Категория BX</div>
                <div class="card-value" id="countBX">–</div>
            </div>
            <div class="card" style="background-color: #ffe344;">
                <div class="card-title">Категория BY</div>
                <div class="card-value" id="countBY">–</div>
            </div>
            <div class="card" style="background-color: #ffb700;">
                <div class="card-title">Категория BZ</div>
                <div class="card-value" id="countBZ">–</div>
            </div>
            <div class="card" style="background-color: #ff4800;">
                <div class="card-title">Категория CX</div>
                <div class="card-value" id="countCX">–</div>
            </div>
            <div class="card" style="background-color: #ff5731;">
                <div class="card-title">Категория CY</div>
                <div class="card-value" id="countCY">–</div>
            </div>
            <div class="card" style="background-color: #ff0000;">
                <div class="card-title">Категория CZ</div>
                <div class="card-value" id="countCZ">–</div>
            </div>
        </div>

        <!-- 2. Таблица результатов -->
        <details open style="display:none;">
            <summary>Таблица XYZ-анализа</summary>
            <div style="overflow-x:auto;">
            <table id="resTable" class="styled-table" style="width:100%;">
                <thead></thead>
                <tbody></tbody>
            </table>
            </div>
        </details>

        <!-- 3. Scater -->
        <details open style="display:none;">
            <summary>Распределение учеников по оценкам и пропускам</summary>
            <div id="chart_div" style="width:100%; height:700px;"></div>
        </details>
        
        <!-- Круговая диаграмма -->
        <details open style="display:none;">
            <summary>Соотношение учащихся по группам</summary>
            <div id="chart_pie3d" style="width:100%; height:700px;"></div>
        </details>          
        
    </div>

    <div id="recommendations" style="display: none;">
        <h2>Рекомендации по группам ABC/XYZ-анализа:</h2>
        <p><strong class="group-AX">Группа AX:</strong> Ученики с высокими и стабильными показателями успеваемости и посещаемости, нуждающиеся в минимальном контроле. Рекомендуется продолжать текущие стратегии поддержки.</p>
        <p><strong class="group-AY">Группа AY:</strong> Ученики с высокими показателями успеваемости, но нестабильной посещаемостью. Необходимо усилить контроль посещаемости и мотивировать к регулярному посещению занятий.</p>
        <p><strong class="group-AZ">Группа AZ:</strong> Ученики с высокими показателями успеваемости и очень нестабильной посещаемостью. Требуется индивидуальный подход и мотивационные беседы для стабилизации посещаемости.</p>
        <p><strong class="group-BX">Группа BX:</strong> Ученики со средней успеваемостью и стабильной посещаемостью. Рекомендуется дополнительная поддержка для повышения успеваемости через мотивационные программы и наставничество.</p>
        <p><strong class="group-BY">Группа BY:</strong> Ученики со средней успеваемостью и нестабильной посещаемостью. Необходимо работать над мотивацией к учебе и посещаемости через вовлечение в школьные мероприятия и консультации.</p>
        <p><strong class="group-BZ">Группа BZ:</strong> Ученики со средней успеваемостью и очень нестабильной посещаемостью. Требуется усиленный контроль и индивидуальный подход для стабилизации посещаемости и повышения успеваемости.</p>
        <p><strong class="group-CX">Группа CX:</strong> Ученики с низкой успеваемостью, но стабильной посещаемостью. Рекомендуется систематическая поддержка, включая дополнительные занятия и наставничество для улучшения успеваемости.</p>
        <p><strong class="group-CY">Группа CY:</strong> Ученики с низкой успеваемостью и нестабильной посещаемостью. Необходимо значительное внимание со стороны педагогов и психологов для стабилизации посещаемости и улучшения учебных результатов.</p>
        <p><strong class="group-CZ">Группа CZ:</strong> Ученики с низкой успеваемостью и очень нестабильной посещаемостью. Требуется комплексный подход, включающий работу с родителями, индивидуальные занятия и мотивационные программы.</p>
    </div>
    
</body>
</html>
